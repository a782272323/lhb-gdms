<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="lhb.gdms.consumer.blog.mapper.OtherMapper">

    <resultMap id="sysUserIconMap1" type="lhb.gdms.commons.domain.entity.SysUserIconEntity">
        <id column="sys_user_icon_id" property="sysUserIconId"/>
        <result column="user_icon_url" property="userIconUrl" />
        <result column="user_icon_name" property="userIconName" />
        <result column="key" property="key" />
        <result column="is_default" property="isDefault" />
        <result column="created" property="created" />
        <result column="updated" property="updated" />
    </resultMap>

    <resultMap id="sysLabelMap1" type="lhb.gdms.commons.domain.entity.SysLabelEntity">
        <id column="label_id" property="labelId"/>
        <result column="label_name" property="labelName" />
        <result column="label_icon_url" property="labelIconUrl" />
        <result column="label_icon_key" property="labelIconKey" />
        <result column="created" property="created" />
        <result column="updated" property="updated" />
    </resultMap>



    <!-- 获取全部系统头像信息 -->
    <select id="getIconLists" resultMap="sysUserIconMap1">
        SELECT DISTINCT * FROM sys_user_icon
    </select>

    <!-- 根据id查询系统头像信息 -->
    <select id="getIconInfoById" resultMap="sysUserIconMap1">
        SELECT DISTINCT * FROM sys_user_icon WHERE sys_user_icon_id = ${sysUserIconId}
    </select>

    <!-- 获取全部标签信息 -->
    <select id="getLabelLists" resultMap="sysLabelMap1">
        SELECT DISTINCT * FROM sys_label
    </select>

    <!-- 搜索标签信息 -->
    <select id="queryLabelLists" resultMap="sysLabelMap1">
        SELECT DISTINCT * FROM sys_label
        WHERE label_name LIKE CONCAT(concat('%', #{keyWord}), '%')
    </select>

    <!-- 查询该标签下有多少人关注 -->
    <select id="getLabelFocusCount" resultType="java.lang.Integer">
        SELECT COUNT(*)
        FROM sys_label_focus
        WHERE label_id = #{labelId}
    </select>

    <!-- 判断当前登录用户是否关注了该标签 -->
    <select id="findLabelFocusInfoById" resultType="lhb.gdms.commons.domain.entity.SysLabelFocusEntity">
        SELECT * FROM sys_label_focus
        WHERE sys_user_id = #{sysUserId}
        AND label_id = #{labelId}
    </select>

    <!-- 取消标签关注 -->
    <delete id="deleteLabelFocusOne">
        DELETE FROM sys_label_focus
        WHERE label_id = #{labelId}
        AND sys_user_id = #{sysUserId}
    </delete>

    <!-- 添加标签关注 -->
    <insert id="insertLabelFocus">
        INSERT INTO sys_label_focus
            (
             label_id,
             sys_user_id,
             created,
             upadted
            ) VALUES
            (
             #{entity.labelId},
             #{entity.sysUserId},
             #{entity.created},
             #{entity.updated}
            )
    </insert>

    <!-- 根据文章和收藏集id查询 sys_article_collection 数据 -->
    <select id="getArticleCollectionInfoByTwoId" resultType="java.util.HashMap">
        SELECT sys_article_collection_id AS sysArticleCollectionId,
               article_id AS articleId,
               sys_collection_id AS sysCollectionId
        FROM sys_article_collection
        WHERE sys_collection_id = #{sysCollectionId}
        AND article_id = #{articleId}
    </select>

    <!-- 添加文章到收藏集 -->
    <insert id="insertArticleToCollection">
        INSERT INTO sys_article_collection
            (
             article_id,
             sys_collection_id
            )
            VALUES
            (
             #{articleId},
             #{sysCollectionId}
            )
    </insert>

    <!-- 取消文章的收藏 -->
    <delete id="deleteArticleToCollection">
        DELETE FROM sys_article_collection
        WHERE sys_collection_id = #{sysCollectionId}
        AND article_id = #{articleId}
    </delete>

    <!-- 获取评论点赞数量 -->
    <select id="getCommentsPraiseCount" resultType="java.lang.Integer">
        SELECT COUNT(*) FROM sys_comments_praise
        WHERE sys_article_comments_id = #{sysArticleCommentsId}
    </select>

    <!-- 根据评论表id和用户id查询数据 -->
    <select id="getCommentsPraiseByTwoId" resultType="java.util.HashMap">
        SELECT * FROM sys_comments_praise
        WHERE sys_article_comments_id = #{sysArticleCommentsId}
        AND sys_user_id = #{sysUserId}
    </select>

    <!-- 点赞评论 -->
    <insert id="insertCommentsPraise">
        INSERT INTO sys_comments_praise
            (
             sys_article_comments_id,
             sys_user_id,
             created,
             updated
            )
            VALUES
            (
             #{entity.sysArticleCommentsId},
             #{entity.sysUserId},
             #{entity.created},
             #{entity.updated}
            )
    </insert>

    <!-- 取消评论点赞 -->
    <delete id="deleteCommentsPraise">
        DELETE FROM sys_comments_praise
        WHERE sys_article_comments_id = #{sysArticleCommentsId}
        AND sys_user_id = #{sysUserId}
    </delete>

    <!-- 获取回复点赞数量 -->
    <select id="getReplyPraiseCount" resultType="java.lang.Integer">
        SELECT COUNT(*) FROM sys_reply_praise
        WHERE sys_comments_reply_id = #{sysCommentsReplyId}
    </select>

    <!-- 根据回复id和用户id查询回复点赞表数据 -->
    <select id="getReplyPraiseInfoByTwoId" resultType="java.util.HashMap">
        SELECT * FROM sys_reply_praise
        WHERE sys_comments_reply_id = #{sysCommentsReplyId}
        AND sys_user_id = #{sysUserId}
    </select>

    <!-- 回复点赞 -->
    <insert id="insertReplyPraise">
        INSERT INTO sys_reply_praise
            (
             sys_comments_reply_id,
             sys_user_id,
             created,
             updated
            ) VALUES
            (
             #{entity.sysCommentsReplyId},
             #{entity.sysUserId},
             #{entity.created},
             #{entity.updated}
            )
    </insert>

    <!-- 取消回复的点赞 -->
    <delete id="deleteReplyPraise">
        DELETE FROM sys_reply_praise
        WHERE sys_comments_reply_id = #{sysCommentsReplyId}
        AND sys_user_id = #{sysUserId}
    </delete>
</mapper>